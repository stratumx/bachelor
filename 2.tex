\chapter{Разработка математической модели}
\section {Описание методики}

Разработку концепции изменённой системы управления следует начать с определения, будет ли установка использовать все шесть координат. Ведь, строго говоря, она будет иметь пять координат, три поступательных и два вращательных направления. Шестая координата, а именно, вращение печатающей головки вокруг своей оси, не будет иметь столь решающей роли в механизме, но, тем не менее, оно тоже будет учитываться, например, для предотвращения соударений.

Разбиение модели на криволинейные слои элементарнее всего представить в виде сфер, так как среди всех криволинейных поверхностей сферические поверхности характеризуются простотой представления и описания математическим языком. Другими словами, идея заключается в разбиении модели на набор сферических слоёв с определённой толщиной стенок, согласно возможностям сопла и экструдера установки, и постепенное их наращивание при построении модели. На этапе разработки можно сказать, что данный подход обладает следующими достоинствами:

\begin{itemize}
\item[$-$] возможность манипулирования рабочим модулем в более широком диапазоне, что позволит лучше контролировать процесс построения модели;
\item[$-$] возможность выбора способа построения модели стандартными плоскими или криволинейными слоями, организация которого может происходить как вручную при настройке построения, так и автоматически, на этапе анализа модели;
\item[$-$] повышение точности и качества построения криволинейных поверхностей, например, поверхности линз;
\item[$-$] повышение прочностных характеристик модели, так как площадь соприкосновения между слоями будет больше.
\end{itemize}

Недостатки, выявленные в ходе предварительного анализа подхода:

\begin{itemize}
\item[$-$] невозможно получить экономию материала, поскольку материал поддержки для нависающих частей модели всё ещё требуется;
\item[$-$] увеличение времени печати модели, так как может потребоваться больше процессорного времени для составления УП и проведения вычислений;
\item[$-$] исходящее из предыдущего пункта усложнение генерации УП, что может быть неприемлемо при промышленных темпах работы.
\end{itemize}

Таким образом, можно видеть, что данный подход имеет больше достоинств, чем недостатков, и может быть принят к рассмотрению.

\section {Этап предварительного анализа}

Определившись с концепцией, необходимо представить себе разбиение модели на сферические поверхности, воспользовавшись для этого программой для создания 3д-моделей. Одной из наиболее популярных и простых в освоении программ является OpenSCAD.

 OpenSCAD - инструмент, выполняющий построение модели путём составления ряда команд. Он хорошо подходит для работы с объектами, описываемыми формулами или параметрами, и его подход к 3D объекту основывается на математике и программировании\,\cite{3dprint}.

Для наглядности объектом для разбиения был выбран трёхмерный крест, состоящий из семи кубов, и составлен соответствующий набор команд для отображения фигуры. Манипулируя диаметрами сфер в коде, можно получить представление о любом из слоёв.


\begin{lstlisting} [
language=python,showstringspaces=false,basicstyle=\ttfamily\small,
    numbers=left,numberstyle=\footnotesize,numbersep=5pt,frame=tb,
    caption={Набор команд для отображения сферического слоя детали в OpenSCAD}
    ]
difference() //обрезка половины
	{
difference()
	{
union()
	{
		cube(size=[100,100,300], center = true);
		cube(size=[100,300,100], center = true);
		cube(size=[300,100,100], center = true);
	}
	union()
	{
	difference()
		{
			sphere(d=400);
			sphere(d=232); // внешний диаметр
		}
		sphere(d=230); // внутренний диаметр
	}	}	}}
\end{lstlisting}


Результат работы кода представлен на рисунке\,\ref{f:pic3}.

\begin{figure} [ht]
	\centering
	\includegraphics[width=0.5\textwidth]{2-1}
	\caption{Результат работы кода в OpenSCAD, один из сферических слоёв исходной фигуры}
	\label{f:pic3}
\end{figure}

\section {Этап применения математической модели локсодромы}

Таким образом, теперь стоит задача описания такого сферического слоя при помощи рабочего модуля, который оперирует нитью расплавленного материала, то есть, сферическая поверхность должна быть описана единой линией. Наиболее подходящей кривой для такого описания является кривая, известная как {\bf сферическая кривая} или {\bf локсодрома}(рисунок \ref{f:pic0}).

{\it Локсодрома – линия двоякой  кривизны, лежащая на сфере или другой поверхности вращения и пересекающая все меридианы поверхности под постоянным углом}\,\cite{loxodr0}.

\begin{figure} [ht]
	\centering
	\includegraphics[width=0.5\textwidth]{2-0}
	\caption{Сферическая спираль (локсодрома)}
	\label{f:pic0}
\end{figure}

Есть несколько формул для описания локсодромы, в том числе, системы параметрических уравнений.

Для первоначального анализа использовалась программа SolidWorks, а именно, функция <<кривая по уравнению>>. Для отображения кривой в трёхмерном эскизе использовалась следующая система простых параметрических уравнений, дающих довольно приблизительную сферическую спираль.

\begin{equation}
\begin{cases}
X = R \cdot cos(2t) \cdot \sqrt{t} \\
Y = R \cdot sin(2t) \cdot \sqrt{t} \\
Z = R \cdot t
\end{cases}
  \end{equation}
где $R$ - радиус сферы, а $t$ - плавающий параметр, принимающий значения на отрезке (-1 ; 1). Подставляя эти формулы в параметры кривой, а также используя функцию <<бобышка/основание по траектории>> для придания получившенийся из уравнений кривой некоторой толщины, получается фигура, представленная на рисунке \ref{f:pic4}.

\begin{figure} [ht]
	\centering
	\includegraphics[width=0.75\textwidth]{2-2}
	\caption{Результат построения сферической кривой в SolidWorks}
	\label{f:pic4}
\end{figure}

Строго говоря, данная кривая не является локсодромой, так как в формуле нет постоянного угла, а так же расположение витков непостоянно и сгущается к экватору, полюса же остаются пустыми. Необходимо использовать другую формулу, а именно формула локсодромы с использованием постоянного угла и гиперболических функций\,\cite{loxodr1}:

\begin{equation}\label{e:lxdrm}
\begin{cases}
X = \dfrac{R \cdot cos(\lambda)}{cosh[m(\lambda-\lambda_0)]} \\
Y = \dfrac{R \cdot cos(\lambda)}{cosh[m(\lambda-\lambda_0)]} \\
Z = R \cdot tanh[m(\lambda-\lambda_0)]
\end{cases}
  \end{equation}
где $R$ - радиус сферы, $m$ - параметр, определяющий угол между кривой и меридианом, \( \lambda \) - значение, лежащее в отрезке \( (-\infty ; +\infty) \), а \( \lambda_0 \) - значение параметра \( \lambda \) на экваторе сферы.

Данную систему параметрических уравнений также можно выразить, осуществив замену гиперболических функций их тригонометрическими представлениями.

\begin{equation}
\begin{cases}
X = R \cdot cos(\lambda) \cdot cos(\dfrac{1}{tan[m(\lambda-\lambda_0)]}) \\
Y = R \cdot sin(\lambda) \cdot cos(\dfrac{1}{tan[m(\lambda-\lambda_0)]}) \\
Z =  R \cdot sin(\dfrac{1}{tan[m(\lambda-\lambda_0)]})
\end{cases}
  \end{equation}

На основе формулы \eqref{e:lxdrm} была составлена программа уже на языке Python с подключенным пакетом Matplotlib\,\cite{python}\,\cite{python2}. Пакет Matplotlib осуществляет построение графиков, в том числе трёхмерных, что необходимо для отображения необходимой кривой. Соответственно, программа должна принимать на вход набор параметров (радиус, угол, \( \lambda_0 \)) и, подставляя значения в формулу, строить трёхмерный график с локсодромой.

%\newpage
Текст программы:

\begin{lstlisting} [
language=python,showstringspaces=false,basicstyle=\ttfamily\small,
    numbers=left,numberstyle=\footnotesize,numbersep=5pt,frame=tb,
    caption={Программа генерации локсодромы}
    ]
from matplotlib.pyplot import *
from numpy import *
from mpl_toolkits.mplot3d import Axes3D

r = 50 # радиус
m = 0.038 # угол

# диапазон значений \( \lambda \)
t = linspace(-100.0, 100.0, 500)
l = 0.9 ** t # \( \lambda_0 \)

# набор параметрических уравнений
x = r * cos(t) / cosh(m * (t-l))
y = r * sin(t) / cosh(m * (t-l))
z = r * tanh(m * (t-l)) + t

# вывод графика
fig = figure(figsize=(4,4))
ax = fig.add_subplot(111,projection='3d')
ax.view_init(30,60)
ax.plot(x,y,z)
ax.set_xlabel(r'x')
ax.set_ylabel(r'y')
ax.set_zlabel(r'z')
\end{lstlisting}

%\newpage
График, получаемый при запуске программы, приведён на рис. \ref{f:pic5}:

\begin{figure} [ht]
	\centering
	\includegraphics[width=0.5\textwidth]{2-3}
	\caption{Результат работы программы на Python, построение локсодромы}
	\label{f:pic5}
\end{figure}

Анализируя полученный результат, данная математическая модель была признана не удовлетворяющей условиям поставленной задачи, поскольку расстояние между витками очень сильно плавает, а на полюсах сферы можно видеть пустые области. Построение такой сферы нитью расплавленного материала невозможно при любых входных параметрах, поэтому код программы необходимо переписать для получения сферической кривой с равным расстоянием между витками.

\section {Этап применения математической модели архимедовой сферической спирали}

Спираль, обладающая постоянной частотой витков, носит название {\bf архимедова спираль} и описание её уже не ограничивается параметрическими уравнениями. При построении такой спирали учитываются уже не один постоянный угол, а два: вертикальный и горизонтальный. В ходе написания программы была определена математическая модель описания кривой, которую в общем виде можно описать следующими параметрическими уравнениями:

\begin{equation}
\begin{cases}
X = R \cdot cos(t \cdot \alpha) \cdot cos(\phi) \\
Y =  R \cdot sin(t \cdot \alpha) \\
Z =  R \cdot cos(t \cdot \alpha) \cdot sin(\phi)
\end{cases}
  \end{equation}
где $R$ - радиус сферы, \( \alpha = \frac{\pi}{0,5 \cdot R} \) - вертикальный угол, \( \phi = i \cdot \beta; i \in (0; 2R) \) - угол поворота каждого из отрезков кривой, \( \beta =  \frac {\pi}{R \cdot n} \) - горизонтальный угол, $n$ - число витков, \( t \in (-R; R) \).

На основе данной математической модели была составлена программа на языке Python с подключением пакета графиков Matplotlib. Текст программы находится в приложении\,\ref{app:ash}. При запуске программы строится следующий график:

\begin{figure} [ht]
	\centering
	\includegraphics[width=0.75\textwidth]{2-4}
	\caption{Результат работы программы на Python, построение архимедовой сферической спирали}
	\label{pic6}
\end{figure}

Анализ полученного графика показал, что витки спирали находятся на одинаковом расстоянии, так что можно сделать вывод, что разработка математической модели описания кривой завершено. Теперь необходимо представить эту кривую в виде нити с некоторой толщиной сечения. Для решения этой задачи требуется SolidWorks, а точнее, функция <<кривая через точки XYZ>>. Данная функция принимает на вход координаты кривой в виде файла с расширением .sldcrv. Структура такого файла содержит строки со значениями координат по направлениям X, Y и Z, формируя таким образом массив \( 3 \times n\) , где n - число точек, образующих кривую. Программа была модифицирована путём добавления процедуры записи координат точек кривой в файл. Таким образом, файл с координатами был сгенерирован и принят на вход программой SolidWorks со следующим результатом:

\begin{figure} [h]
	\centering
	\includegraphics[width=0.75\textwidth]{2-5}
	\caption{Построение архимедовой сферической спирали в SolidWorks через координаты}
	\label{pic7}
\end{figure}

Придавая получившейся линии некоторую толщину, можно получить некоторое представление сферического слоя, выполненного нитью из материала. Изображение такого слоя представлено в приложении \ref{app:esk}. При этом нужно понимать, что толщина нити при печати обычно очень небольшая и составляет около 0,1–0,2 мм. Для создания многослойных структур необходимо выявить зависимость между радиусом и числом витков:

\begin{equation}
h = \frac{\pi \cdot R}{n} \Leftrightarrow n = \frac{\pi \cdot R}{h}
\end{equation}
где $h$ - толщина нити в мм, $R$ - радиус сферического слоя по центру сечения нити, $n$ - количество витков. Например, при радиусе в 20 мм и толщине нити 0,2 мм, число витков будет равно 100.

Пользуясь этим соотношением, можно сформировать эскиз многослойного построения в программе SolidWorks, генерируя наборы координат с соответствующими входными параметрами. Примеры эскизов представлены в приложении \ref{app:esk}. 